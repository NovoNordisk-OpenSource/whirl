<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Execute Scripts • whirl</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Execute Scripts">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">whirl</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/whirl.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example.html">Log example</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/novonordisk-opensource/whirl/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Execute Scripts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/novonordisk-opensource/whirl/blob/feat/pre-commit/vignettes/whirl.Rmd" class="external-link"><code>vignettes/whirl.Rmd</code></a></small>
      <div class="d-none name"><code>whirl.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The whirl package provides functionalities for executing scripts in
batch while simultaneously getting logs from the individual executions.
In the following sections, we will go through how to use the
package.</p>
</div>
<div class="section level2">
<h2 id="ways-to-call-the-run-function">Ways to call the <code>run()</code> function<a class="anchor" aria-label="anchor" href="#ways-to-call-the-run-function"></a>
</h2>
<div class="section level3">
<h3 id="single-and-multiple-files-and-wild-cards">Single and multiple files, and wild cards<a class="anchor" aria-label="anchor" href="#single-and-multiple-files-and-wild-cards"></a>
</h3>
<p>The <code>input</code> argument in the <code><a href="../reference/run.html">run()</a></code> function
can in the most simple case point to a single file for which an
execution and log-generation is required.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://novonordisk-opensource.github.io/whirl/">whirl</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"path/to/script.R"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>input</code> argument can also point to multiple files in a
directory using wildcard (or globbing) patterns. In this case, all
scripts in the directory will be executed in parallel and a log will be
generated for each script. The number of workers can be specified
through the <code>n_workers</code> argument (default is set to one). A
summary log file will also be provided as a fast way to get an overview
of the execution. The location of the summary file can be controlled
with the <code>summary_file</code> argument.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Execution of all R files in a specific directory</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="st">"path/to/directory/*.R"</span>, </span>
<span>  n_workers <span class="op">=</span> <span class="fl">4</span>, </span>
<span>  summary_file <span class="op">=</span> <span class="st">"path/to/summary"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Execution of all R files starting with "mk200" in a specific directory</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="st">"path/to/directory/mk200*.R"</span>, </span>
<span>  n_workers <span class="op">=</span> <span class="fl">8</span>, </span>
<span>  summary_file <span class="op">=</span> <span class="st">"path/to/summary"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>More information on how the wildcards are interpreted see
<code><a href="https://rdrr.io/r/base/Sys.glob.html" class="external-link">Sys.glob()</a></code>.</p>
<p>It is also possible to provide a character vector of several paths
(either single files or glob expression) that should be executed. Note
that whenever the <code>input</code> argument in is supplied with a
character vector
(e.g. <code>c("path/to/script1.R", "path/to/script2.R")</code>) it
assumes that these can be executed independently and in parallel. If the
elements needs to be executed sequentially this can be achieved by using
a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> instead (see below).</p>
</div>
<div class="section level3">
<h3 id="using-list-as-input">Using <code>list()</code> as input<a class="anchor" aria-label="anchor" href="#using-list-as-input"></a>
</h3>
<p>If the scripts have to be executed in a specific order, the
<code>input</code> argument can be supplied as a list. The scripts will
then be executed in the order they are listed in the list, with scripts
listed in the same element being executed in parallel (if
<code>n_workers</code> &gt; 1).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In the below example, script1.R and script2.R will be executed in parallel</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path/to/script1.R"</span>,</span>
<span>            <span class="st">"path/to/script2.R"</span><span class="op">)</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In the below example, script1.R and script2.R will be executed in parallel, </span></span>
<span><span class="co"># and all R files in the directory will subsequently be executed in parallel</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path/to/script1.R"</span>, <span class="st">"path/to/script2.R"</span><span class="op">)</span>, </span>
<span>    <span class="st">"path/to/directory/*.R"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In the below example, script1.R and script2.R will be executed in parallel, and subsequently </span></span>
<span><span class="co"># script3.R and script4.R will be executed in parallel</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path/to/script1.R"</span>, <span class="st">"path/to/script2.R"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path/to/script3.R"</span>, <span class="st">"path/to/script4.R"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The list can also be supplied with names list elements. This can be
useful during execution as some of these ‘name’ will be printed to the
console.</p>
<p>E.g.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Step 1"</span>, </span>
<span>    paths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path/to/script1.R"</span>, <span class="st">"path/to/script2.R"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Step 2"</span>,</span>
<span>    paths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path/to/script3.R"</span>, <span class="st">"path/to/script4.R"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  n_workers <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-a-configuration-file-as-input">Using a configuration file as input<a class="anchor" aria-label="anchor" href="#using-a-configuration-file-as-input"></a>
</h3>
<p>The execution order can also be pre-specified in a configuration file
(config file for short). The config file could have the following
structure.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"Step 1"</span><span class="at">    </span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span><span class="at">    </span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"path/to/script1.R"</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"path/to/script2.R"</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"Step 2"</span><span class="at">  </span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span><span class="at">    </span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"path/to/script3.R"</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"path/to/script4.R"</span></span></code></pre></div>
<p>In this case, the <code>input</code> argument in the
<code><a href="../reference/run.html">run()</a></code> function should point to the config file. Assuming
the config file is called <code>config.yaml</code>, the execution can be
initiated as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"path/to/config.yaml"</span>, n_workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>Each steps in the config file will be executed independently while
scrips within each step will be executed in parallel using the number of
workers specified with the <code>n_workers</code> argument.</p>
</div>
</div>
<div class="section level2">
<h2 id="adjusting-the-log-directory">Adjusting the log directory<a class="anchor" aria-label="anchor" href="#adjusting-the-log-directory"></a>
</h2>
<div class="section level3">
<h3 id="how-to-use-the-log_dir-argument-to-specify-where-to-store-the-logs">How to use the <code>log_dir</code> argument to specify where to
store the logs<a class="anchor" aria-label="anchor" href="#how-to-use-the-log_dir-argument-to-specify-where-to-store-the-logs"></a>
</h3>
<p>When executing <code><a href="../reference/run.html">run()</a></code> the default is to store logs in the
directory where the individual scripts are located. For example, if we
apply <code><a href="../reference/run.html">run()</a></code> to a a vector of scripts with the following
paths <code>c(path/to/dir1/script1.R, path/to/dir2/script2.R)</code>,
the log of script1.R and script2.R will be stored in
<strong>path/to/dir1</strong> and <strong>path/to/dir2</strong>,
respectively.</p>
<p>If the logs should be stored in a different directory, the
<code>log_dir</code> argument can be used. This argument can be supplied
with a character string or a function. Note that in either case the
directory that <code>log_dir</code> points to must exist before the
execution is initiated.</p>
<p>If the <code>log_dir</code> is supplied with a character pointing to
a specific path the call could look like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"path/to/script.R"</span>, log_dir <span class="op">=</span> <span class="st">"path/to/logs"</span><span class="op">)</span></span></code></pre></div>
<p>In this example the log of script.R will be stored in
<strong>path/to/logs</strong>.<br>
Note that if multiple scripts are executed and <code>log_dir</code> is a
character to a path, then every log will be redirected to the same
directory - in this case <strong>path/to/logs</strong>.</p>
<p>If a more dynamic approach is needed the <code>log_dir</code>
argument can also be supplied with a function that will be applied to
the individual path of every script.<br>
For example, if multiple script are executed and the logs needs to be
stored in a sub-folder within the script directories this could be
achieved by:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"path/to/dir1/script1.R"</span>, <span class="st">"path/to/dir2/script2.R"</span><span class="op">)</span>, </span>
<span>    log_dir <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"/logs"</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>In this exampel the log of script1.R will be stored in
<strong>path/to/dir1/logs</strong> and the log of script2.R will be
stored in <strong>path/to/dir2/logs</strong>.</p>
<p>Note that <strong>x</strong> refer to the path of the script that is
being executed.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aksel Thomsen, Lovemore Gakava, Cervan Girard, Kristian Troejelsgaard, Steffen Falgreen Larsen, Vladimir Obucina.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
