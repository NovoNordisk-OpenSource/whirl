---
title: "`r params$title`"
date: "`r Sys.time()`"
date-format: "YYYY-MM-DDTHH:mm:ss zzz"
params:
  title: 'dev'
  script_md: 'dev'
  strace: FALSE
  strace_path: ''
  strace_discards: NULL
  objects_path: ''
  renv: TRUE
format:
  html:
    embed-resources: true
    toc: true
    toc-depth: 2
    toc-expand: true
    smooth-scroll: true
---

# Summary

```{r, echo=FALSE}
if (is.character(params$renv) && params$renv == "yes" | is.logical(params$renv) && params$renv){
  whirl:::renv_status()
}
```

```{r, echo=FALSE}
use_strace <- (is.character(params$strace) && params$strace == "yes" | is.logical(params$strace) && params$strace)

if (use_strace){
  strace_info <- whirl:::readstrace_info(
    path = params$strace_path, 
    strace_discards = params$strace_discards)
}

```

```{r, echo=FALSE, results='asis', eval=use_strace}
cat("## Input", "\n")
```

```{r, echo=FALSE, eval=use_strace}
strace_info$input
```

```{r, echo=FALSE, results='asis', eval=use_strace}
cat("## Output", "\n")
```

```{r, echo=FALSE, eval=use_strace}
strace_info$output
```

# Script

```{r, child = params$script_md}
```

# Session info

```{r, include=FALSE}
knitr::opts_chunk$set(
  error = FALSE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE
)

info <- whirl:::session_info()

```

```{r, results="asis"}
cat('\n## Platform \n')
info$platform
cat("\n")
```

```{r, results="asis"}
cat('\n## Packages\n')
info$packages
cat("\n")
```

```{r, results="asis"}
cat('\n## Environment variables \n')
info$environment
cat("\n")
```

```{r, results="asis"}
cat('\n## Option settings\n')
info$options
cat("\n")
```

```{r collect-objects}
whirl_objects <- vector("list")

if (exists("strace_info")) {
  whirl_objects$strace_info <- strace_info
}
if (exists("info")) {
  whirl_objects$environment_options <- info
}
saveRDS(whirl_objects, file = params$objects_path)
```
